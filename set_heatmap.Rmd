---
title: "Heatmap of RNAseq replicates"
output:
  html_document:
    toc: yes
    toc_depth: 2
---

```{r}

library(dplyr)
library(pheatmap)
library(cetcolor)
library(RColorBrewer)

setwd('/Users/JQ/Documents/_CODE REPOS/GitHub/Da_RNAseq')
working_dir <- getwd()

# load all datasets obtained with DESEQ2

WT_vs_2D <- read.table(file="output/differential_expression/2D_vs_WT.txt", header=TRUE, sep="\t")
WT_vs_da <- read.table(file="output/differential_expression/da_vs_WT.txt", header=TRUE, sep="\t")
WT_vs_sc <- read.table(file="output/differential_expression/sc_vs_WT.txt", header=TRUE, sep="\t")

fold_2D <- select(WT_vs_2D, matches("ensembl|log2"))
fold_da <- select(WT_vs_da, matches("ensembl|log2"))
fold_sc <- select(WT_vs_sc, matches("ensembl|log2"))

all_fold <- merge(fold_2D, fold_da, by =1)
all_fold <- merge(all_fold, fold_sc, by =1)
colnames(all_fold) <- c("ensemblGeneID", "DaDa", "Da", "Sc")

gene_list <- read.table(file="resources/gene_names.txt", header=TRUE, sep="\t")
gene_list <- add_rownames(gene_list, "ensemblGeneID")

all_fold <- merge(all_fold, gene_list, by =1)


#Gene set preparation
GO_sets <- read.table(file="resources/GO_sets.txt", header=TRUE, sep="\t")

''' 
GO term from the list
 [1] "GO.0043067..regulation.of.programmed.cell.death"               
 [2] "GO.0005912..adherens.junction"                                 
[3] "GO.0005911..cell.cell.junction"                                
[4] "GO.0008593..regulation.of.Notch.signaling.pathway"             
[5] "GO.0043065..positive.regulation.of.apoptotic.process"          
[6] "GO.2001235..positive.regulation.of.apoptotic.signaling.pathway"
[7] "GO.2001234..negative.regulation.of.apoptotic.signaling.pathway"
[8] "GO.0043066..negative.regulation.of.apoptotic.process"          
[9] "GO.0006915..apoptotic.process"                                 
[10] "GO.0008219..cell.death"                                        
[11] "GO.0010940..PRCD"                                              
[12] "GO.0012501..programmed.cell.death" 
'''
#Change number according on the set
i <- 12
#for (i in 1:length(GO_sets)) {
set <- list(GO_sets[[i]])

fold_in_set <- subset(all_fold, ensemblGeneID %in% set[[1]])
rownames(fold_in_set) <- fold_in_set$external_gene_name
fold_in_set[c("ensemblGeneID", "external_gene_name")] <- NULL

## Create Heatmap

# create color palet
col.pal <- cet_pal(n = 256, name = "cbd1", alpha = 1)
n_max <- max(fold_in_set)
n_min <- min(fold_in_set)

if (n_max > abs(n_min)) {max = n_max} else {max = abs(n_min)}

breaksList = seq((-max), max, by=(2*max/256))

hm.parameters <- list(fold_in_set, 
                      color = col.pal,
                      #scale = "row", #Does the z-score
                      cellwidth = 70, #cellheight = 10,
                      breaks = breaksList,
                      fontsize_row = 7,
                      kmeans_k = NA,
                      show_rownames = F, show_colnames = T,
                      main = colnames(GO_sets[i]),
                      clustering_method = "ward.D2",
                      cluster_rows = FALSE, cluster_cols = FALSE,
                      clustering_distance_cols = dcols1)

# prepare path and file.name for output
filename <- paste(colnames(GO_sets[i]),"2", "pdf", sep = ".")
outfile <- paste(working_dir,"output/set_heatmap", filename, sep="/")

# To draw the heat map on screen 
do.call("pheatmap", hm.parameters)

# To draw to file 
#do.call("pheatmap", c(hm.parameters, filename=outfile))

#}

```